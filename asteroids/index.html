<!DOCTYPE html>
<meta charset="utf-8"/>
<html><head><title>Asteroids Tutorial</title>
<link href="https://fonts.googleapis.com/css?family=Quicksand:500,700" rel="stylesheet">
<style>
body {
    font-family: Calibri, sans-serif;
    margin: 20px;
    background: #efefef;
}
p, li, td, h1, h2, h3, h4 {
    font-family: 'Quicksand';
    color: #333;
}
p, li, td, pre {
    font-weight: 500;
    font-size: 11pt;
}
a {
    color: #059dc5;
    text-decoration: none;
}
a:hover {
    text-decoration: underline;
}
p {
    max-width: 600px;
    line-height: 1.4;
}
td {
    padding-right:10px
}
pre {
    margin-top: 0;
    min-width: 600px;
}
.pre {
    display: table;
    margin: 20px 0;
}
img {
    display: block;
    margin: 14px 0;
}
.code {
    font-family: Consolas, Monaco, Inconsolata, monospace;
    border-radius: 8px;
    background: #fff;
    color: #555;
    padding: 12px;
}
.inlinecode {
    font-family: Consolas, Monaco, Inconsolata, monospace;
    color: #555;
}
.console {
    font-family: Consolas, Monaco, Inconsolata, monospace;
    padding: 16px;
    background: #555;
    border-radius: 8px;
    color: #eee;
}
.name {color:#e824b7;}
.call {color:#ab22d0;}
.literal {color:#01afa5; color:#ea9b4c;}
.comment {color:#555; background:#eee; border-radius: 4px;}
.highlight {background:#fcffc4; border-radius: 4px;}
.highlight .comment, .comment .highlight {background:#f0edd3;}
</style>
</head>
<body>
<h3><a href="../">Introduction and other tutorials</a></h3>
<h1>Asteroids</h1>
<h2><a href="asteroids.love">Download asteroids.love</a></h2>
<img src="1.png">
<h2>Rules</h2>
<p>Destroy the asteroids with bullets while avoiding asteroids touching the ship.</p>
<p>Bigger asteroids break into two smaller and faster asteroids when hit with a bullet, and the smallest asteroids are destroyed completely.</p>
<h3>Controls</h3>
<table>
<tr><td><b>s</b></td><td>Shoot bullet</td></tr>
<tr><td><b>Up arrow</b></td><td>Accelerate</td></tr>
<tr><td><b>Left/right arrow</b></td><td>Turn</td></tr>
</table>
<h2>Overview</h2>
<p>The ship has an X and Y position, an X and Y speed, and an angle it is facing.</p>
<p>Each asteroid and bullet is represented by a table containing an X and Y position and an angle it is moving in. An X and Y speed isn't stored for the asteroids and bullets because, unlike the ship, they always move in the direction of their angle.</p>
<p>Each bullet additionally has a number representing how long until the bullet is removed if it doesn't hit an asteroid.</p>
<p>Each asteroid additionally has a number representing its "stage" which is used to determine its speed and radius.</p>
<p>There is a table which contains all the asteroids and another table which contains all the bullets.</p>
<p>Each bullet is checked to see if it collides with any of the asteroids. If it does, both the bullet and asteroid are removed from their tables. If the asteroid isn't in its lowest stage, two new asteroids with the next lowest stage are added to the asteroid table. A random angle is given to one of these asteroids, and the opposite angle is given to the other asteroid.</p>
<p>Each asteroid is checked to see if it collides with the ship. If it does, the game is also reset.</p>
<p>If there are no asteroids left, the game is reset.</p>
<p>So that objects partially off the edge of the screen can be seen on the other side, everything is drawn 9 times; above the screen, below, left, right and the diagonal positions.</p>
<img src="2.png">
<p>To see if an asteroid collides with a bullet or the ship, the difference of the two circle's X axes is squared and added to the difference of the two circle's Y axes squared, and if this is less than or equal to the radiuses added together and squared, then the circles are touching or overlapping: <span class="inlinecode">
(<span class="name">aX</span> - <span class="name">bX</span>)^<span class="literal">2</span> + (<span class="name">aY</span> - <span class="name">bY</span>)^<span class="literal">2</span> <= (<span class="name">aRadius</span> + <span class="name">bRadius</span>)^2</span></p>
<p>The Pythagorean theorem states that the square of a right triangle's hypotenuse is equal to the sum of the squares of the other two sides, i.e. <b>a + b = c</b></p>
<img src="3.png">
<p>The two other sides in this instance are the differences between the positions in the two circles on the X and Y axes.</p>
<img src="4.png">
<p>If the two circles are touching, the hypotenuse length is equal to the radiuses of both of the circles added together.</p>
<img src="5.png">
<p>So, if the squared difference between the X axes (<b>a</b>) plus the squared difference between the Y axes (<b>b</b>) is equal to the two radiuses added and squared, then the two circles are touching. If <b>a + b</b> is less than the two radiuses added and squared, then the two circles are overlapping, or if it's greater, then the two circles are not touching.</p>
<img src="6.png">
<img src="7.png">
<img src="8.png">
<img src="9.png">
<h2>Coding</h2>
<h3>Drawing the ship</h3>
<p>The ship is drawn with a blue circle in the middle of the screen.</p>
<div class="pre"><pre class="code">
function <span class="name">love.draw</span>()
    <span class="call">love.graphics.setColor</span>(<span class="literal">0</span>, <span class="literal">0</span>, <span class="literal">1</span>)
    <span class="call">love.graphics.circle</span>(<span class="literal">'fill'</span>, <span class="literal">800</span> / <span class="literal">2</span>, <span class="literal">600</span> / <span class="literal">2</span>, <span class="literal">30</span>)
end
</pre></div>
<img src="10.png">
<h3>Turning the ship clockwise</h3>
<p>When the right arrow is held down, the ship's angle increases at a rate of 10 radians per second.</p>
<p>To show the angle of the ship, a light blue circle is drawn 20 pixels from the center of the ship in the direction of its angle.</p>
<p>This uses the ship's X and Y positions, so they are made into variables.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="name">shipX</span> = <span class="literal">800</span> / <span class="literal">2</span>
    <span class="name">shipY</span> = <span class="literal">600</span> / <span class="literal">2</span>
    <span class="name">shipAngle</span> = <span class="literal">0</span>
end

function <span class="name">love.update</span>(<span class="name">dt</span>)
    if <span class="call">love.keyboard.isDown</span>(<span class="literal">'right'</span>) then
         <span class="name">shipAngle</span> = <span class="name">shipAngle</span> + <span class="literal">10</span> * <span class="name">dt</span>
    end
end

function <span class="name">love.draw</span>()
    <span class="call">love.graphics.setColor</span>(<span class="literal">0</span>, <span class="literal">0</span>, <span class="literal">1</span>)
    <span class="call">love.graphics.circle</span>(<span class="literal">'fill'</span>, <span class="highlight"><span class="name">shipX</span></span>, <span class="highlight"><span class="name">shipY</span></span>, <span class="literal">30</span>)

    <span class="highlight"><span class="call">love.graphics.setColor</span>(<span class="literal">0</span>, <span class="literal">1</span>, <span class="literal">1</span>)</span>
    <span class="highlight">local <span class="name">shipCircleDistance</span> = <span class="literal">20</span></span>
    <span class="highlight"><span class="call">love.graphics.circle</span>(</span>
    <span class="highlight">    <span class="literal">'fill'</span>,</span>
    <span class="highlight">    <span class="name">shipX</span> + <span class="call">math.cos</span>(<span class="name">shipAngle</span>) * <span class="name">shipCircleDistance</span>,</span>
    <span class="highlight">    <span class="name">shipY</span> + <span class="call">math.sin</span>(<span class="name">shipAngle</span>) * <span class="name">shipCircleDistance</span>,</span>
    <span class="highlight">    <span class="literal">5</span></span>
    <span class="highlight">)</span>

    <span class="highlight"><span class="comment">-- Temporary</span></span>
    <span class="highlight"><span class="call">love.graphics.setColor</span>(<span class="literal">1</span>, <span class="literal">1</span>, <span class="literal">1</span>)</span>
    <span class="highlight"><span class="call">love.graphics.print</span>(<span class="literal">'shipAngle: '</span>..<span class="name">shipAngle</span>)</span>
end
</pre></div>
<img src="11.png">
<h3>Turning the ship counterclockwise</h3>
<p>When the left arrow is held down the ship's angle decreases.</p>
<p>The turning speed is reused, so it is made into a variable.</p>
<div class="pre"><pre class="code">
function <span class="name">love.update</span>(<span class="name">dt</span>)
    <span class="highlight">local <span class="name">turnSpeed</span> = <span class="literal">10</span></span>

    if <span class="call">love.keyboard.isDown</span>(<span class="literal">'right'</span>) then
         <span class="name">shipAngle</span> = <span class="name">shipAngle</span> + <span class="highlight"><span class="name">turnSpeed</span></span> * <span class="name">dt</span>
    end

    <span class="highlight">if <span class="call">love.keyboard.isDown</span>(<span class="literal">'left'</span>) then</span>
    <span class="highlight">    <span class="name">shipAngle</span> = <span class="name">shipAngle</span> - <span class="name">turnSpeed</span> * <span class="name">dt</span></span>
    <span class="highlight">end</span>
end
</pre></div>
<h3>Wrapping the angle</h3>
<p>So that the angle doesn't continue going up beyong 2 pi or down into negative numbers, the modulo operator is used to keep the angle greater than or equal to 0 and less than 2 pi.</p>
<div class="pre"><pre class="code">
function <span class="name">love.update</span>(<span class="name">dt</span>)
    <span class="comment">-- etc.</span>

    if <span class="call">love.keyboard.isDown</span>(<span class="literal">'right'</span>) then
         <span class="name">shipAngle</span> = <span class="highlight">(</span><span class="name">shipAngle</span> + <span class="name">turnSpeed</span> * <span class="name">dt</span><span class="highlight">) % (<span class="literal">2</span> * <span class="name">math.pi</span>)</span>
    end

    if <span class="call">love.keyboard.isDown</span>(<span class="literal">'left'</span>) then
         <span class="name">shipAngle</span> = <span class="highlight">(</span><span class="name">shipAngle</span> - <span class="name">turnSpeed</span> * <span class="name">dt</span><span class="highlight">) % (<span class="literal">2</span> * <span class="name">math.pi</span>)</span>
    end
end
</pre></div>
<h3>Ship acceleration</h3>
<p>The ship is given an X and Y speed.</p>
<p>When the up arrow is pressed, the ship's X and Y speeds are changed based on the ship's angle.</p>
<p>The ship's X and Y position is changed based on the ship's X and Y speed.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="comment">-- etc.</span>
    
    <span class="name">shipSpeedX</span> = <span class="literal">0</span>
    <span class="name">shipSpeedY</span> = <span class="literal">0</span>
end

function <span class="name">love.update</span>(<span class="name">dt</span>)
    <span class="comment">-- etc.</span>

    if <span class="call">love.keyboard.isDown</span>(<span class="literal">'up'</span>) then
        local <span class="name">shipSpeed</span> = <span class="literal">100</span>
        <span class="name">shipSpeedX</span> = <span class="name">shipSpeedX</span> + <span class="call">math.cos</span>(<span class="name">shipAngle</span>) * <span class="name">shipSpeed</span> * <span class="name">dt</span>
        <span class="name">shipSpeedY</span> = <span class="name">shipSpeedY</span> + <span class="call">math.sin</span>(<span class="name">shipAngle</span>) * <span class="name">shipSpeed</span> * <span class="name">dt</span>
    end

    <span class="name">shipX</span> = <span class="name">shipX</span> + <span class="name">shipSpeedX</span> * <span class="name">dt</span>
    <span class="name">shipY</span> = <span class="name">shipY</span> + <span class="name">shipSpeedY</span> * <span class="name">dt</span>
end

function <span class="name">love.draw</span>()
    <span class="comment">-- etc.</span>

    <span class="comment">-- Temporary</span>
    <span class="call">love.graphics.setColor</span>(<span class="literal">1</span>, <span class="literal">1</span>, <span class="literal">1</span>)
    <span class="call">love.graphics.print</span>(<span class="highlight"><span class="call">table.concat</span>({</span>
        <span class="literal">'shipAngle: '</span>..<span class="name">shipAngle</span>,
    <span class="highlight">    <span class="literal">'shipX: '</span>..<span class="name">shipX</span>,</span>
    <span class="highlight">    <span class="literal">'shipY: '</span>..<span class="name">shipY</span>,</span>
    <span class="highlight">    <span class="literal">'shipSpeedX: '</span>..<span class="name">shipSpeedX</span>,</span>
    <span class="highlight">    <span class="literal">'shipSpeedY: '</span>..<span class="name">shipSpeedY</span>,</span>
    <span class="highlight">}, <span class="literal">'\n'</span>)</span>)
end
</pre></div>
<img src="12.png">
<h3>Wrapping the ship</h3>
<p>So that the ship wraps around to the other side of the screen when it goes off the edge, the modulo operator is used to keep the ship's X/Y positions greater than or equal to 0 and less than the width/height of the arena.</p>
<p>The arena width and height are reused, so they are made into variables.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="highlight"><span class="name">arenaWidth</span> = <span class="literal">800</span></span>
    <span class="highlight"><span class="name">arenaHeight</span> = <span class="literal">600</span></span>

    <span class="name">shipX</span> = <span class="highlight"><span class="name">arenaWidth</span></span> / <span class="literal">2</span>
    <span class="name">shipY</span> = <span class="highlight"><span class="name">arenaHeight</span></span> / <span class="literal">2</span>

    <span class="comment">-- etc.</span>
end

function <span class="name">love.update</span>(<span class="name">dt</span>)
    <span class="comment">-- etc.</span>

    <span class="name">shipX</span> = <span class="highlight">(</span><span class="name">shipX</span> + <span class="name">shipSpeedX</span> * <span class="name">dt</span><span class="highlight">) % <span class="name">arenaWidth</span></span>
    <span class="name">shipY</span> = <span class="highlight">(</span><span class="name">shipY</span> + <span class="name">shipSpeedY</span> * <span class="name">dt</span><span class="highlight">) % <span class="name">arenaHeight</span></span>
end
</pre></div>
<h3>Drawing partially off-screen objects</h3>
<p>So that objects partially off the edge of the screen can be seen on the other side, the coordinate system is translated to different positions and everything is drawn at each position around the screen and in the center.</p>
<div class="pre"><pre class="code">
function <span class="name">love.draw</span>()
    <span class="highlight">for <span class="name">y</span> = -<span class="literal">1</span>, <span class="literal">1</span> do</span>
    <span class="highlight">    for <span class="name">x</span> = -<span class="literal">1</span>, <span class="literal">1</span> do</span>
    <span class="highlight">        <span class="call">love.graphics.origin</span>()</span>
    <span class="highlight">        <span class="call">love.graphics.translate</span>(<span class="name">x</span> * <span class="name">arenaWidth</span>, <span class="name">y</span> * <span class="name">arenaHeight</span>)</span>

            <span class="call">love.graphics.setColor</span>(<span class="literal">0</span>, <span class="literal">0</span>, <span class="literal">1</span>)
            <span class="call">love.graphics.circle</span>(<span class="literal">'fill'</span>, <span class="name">shipX</span>, <span class="name">shipY</span>, <span class="literal">30</span>)

            <span class="call">love.graphics.setColor</span>(<span class="literal">0</span>, <span class="literal">1</span>, <span class="literal">1</span>)
            <span class="call">love.graphics.circle</span>(<span class="literal">'fill'</span>, <span class="name">shipX</span> + <span class="call">math.cos</span>(<span class="name">shipAngle</span>) * <span class="literal">20</span>, <span class="name">shipY</span> + <span class="call">math.sin</span>(<span class="name">shipAngle</span>) * <span class="literal">20</span>, <span class="literal">5</span>)
    <span class="highlight">    end</span>
    <span class="highlight">end</span>

    <span class="comment">-- Temporary</span>
    <span class="highlight"><span class="call">love.graphics.origin</span>()</span>
    <span class="call">love.graphics.setColor</span>(<span class="literal">1</span>, <span class="literal">1</span>, <span class="literal">1</span>)
    <span class="call">love.graphics.print</span>(<span class="call">table.concat</span>({
        <span class="literal">'shipAngle: '</span>..<span class="name">shipAngle</span>
        <span class="literal">'shipX: '</span>..<span class="name">shipX</span>,
        <span class="literal">'shipY: '</span>..<span class="name">shipY</span>,
        <span class="literal">'shipSpeedX: '</span>..<span class="name">shipSpeedX</span>,
        <span class="literal">'shipSpeedY: '</span>..<span class="name">shipSpeedY</span>,
    }, <span class="literal">'\n'</span>))
end
</pre></div>
<img src="13.png">
<h3>Bullets</h3>
<p>For now, a bullet is represented by a table with an X and Y position, and when the <b>s</b> key is pressed it is created at the position of the ship and added to the bullets table.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="comment">-- etc.</span>

    <span class="name">bullets</span> = {}
end

function <span class="name">love.draw</span>()
    for <span class="name">y</span> = -<span class="literal">1</span>, <span class="literal">1</span> do
        for <span class="name">x</span> = -<span class="literal">1</span>, <span class="literal">1</span> do
            <span class="comment">-- etc.</span>

            for <span class="name">bulletIndex</span>, <span class="name">bullet</span> in <span class="call">ipairs</span>(<span class="name">bullets</span>) do
                <span class="call">love.graphics.setColor</span>(<span class="literal">0</span>, <span class="literal">1</span>, <span class="literal">0</span>)
                <span class="call">love.graphics.circle</span>(<span class="literal">'fill'</span>, <span class="name">bullet.x</span>, <span class="name">bullet.y</span>, <span class="literal">5</span>)
            end
        end
    end
end

function <span class="name">love.keypressed</span>(<span class="name">key</span>)
    if <span class="name">key</span> == <span class="literal">'s'</span> then
        <span class="call">table.insert</span>(<span class="name">bullets</span>, {
            <span class="name">x</span> = <span class="name">shipX</span>,
            <span class="name">y</span> = <span class="name">shipY</span>,
        })
    end
end
</pre></div>
<img src="14.png">
<h3>Creating bullets at edge of ship</h3>
<p>The bullets are now created at the ship's radius away from the ship's position in the direction of the ship's angle.</p>
<p>The ship's radius is reused, so it is made into a variable.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="comment">-- etc.</span>

    <span class="name">shipRadius</span> = <span class="literal">30</span>
end

function <span class="name">love.draw</span>()
    for <span class="name">y</span> = -<span class="literal">1</span>, <span class="literal">1</span> do
        for <span class="name">x</span> = -<span class="literal">1</span>, <span class="literal">1</span> do
            <span class="comment">-- etc.</span>

            <span class="call">love.graphics.circle</span>(<span class="literal">'fill'</span>, <span class="name">shipX</span>, <span class="name">shipY</span>, <span class="highlight"><span class="name">shipRadius</span></span>)
            
            <span class="comment">-- etc.</span>
        end
    end
end

function <span class="name">love.keypressed</span>(<span class="name">key</span>)
    if <span class="name">key</span> == <span class="literal">'s'</span> then
        <span class="call">table.insert</span>(<span class="name">bullets</span>, {
            <span class="name">x</span> = <span class="name">shipX</span> <span class="highlight">+ <span class="call">math.cos</span>(<span class="name">shipAngle</span>) * <span class="name">shipRadius</span>,</span>
            <span class="name">y</span> = <span class="name">shipY</span> <span class="highlight">+ <span class="call">math.sin</span>(<span class="name">shipAngle</span>) * <span class="name">shipRadius</span>,</span>
        })
    end
end
</pre></div>
<img src="15.png">
<h3>Moving bullets</h3>
<p>Newly created bullets are given an angle which is the ship's angle at time of shooting.</p>
<p>The bullet table is looped through and each bullet's X and Y position is updated based on its angle.</p>
<p>So the bullets wrap around the screen, the modulo operator is used to keep the bullet's X/Y positions greater than or equal to 0 and less than the width/height of the arena.</p>
<div class="pre"><pre class="code">
function <span class="name">love.update</span>(<span class="name">dt</span>)
    <span class="comment">-- etc.</span>

    for <span class="name">bulletIndex</span>, <span class="name">bullet</span> in <span class="call">ipairs</span>(<span class="name">bullets</span>) do
        local <span class="name">bulletSpeed</span> = <span class="literal">500</span>
        <span class="name">bullet.x</span> = (<span class="name">bullet.x</span> + <span class="call">math.cos</span>(<span class="name">bullet.angle</span>) * <span class="name">bulletSpeed</span> * <span class="name">dt</span>) % <span class="name">arenaWidth</span>
        <span class="name">bullet.y</span> = (<span class="name">bullet.y</span> + <span class="call">math.sin</span>(<span class="name">bullet.angle</span>) * <span class="name">bulletSpeed</span> * <span class="name">dt</span>) % <span class="name">arenaHeight</span>
    end
end

function <span class="name">love.keypressed</span>(<span class="name">key</span>)
    if <span class="name">key</span> == <span class="literal">'s'</span> then
        <span class="call">table.insert</span>(
            <span class="name">bullets</span>, {
                <span class="name">x</span> = <span class="name">shipX</span> + <span class="call">math.cos</span>(<span class="name">shipAngle</span>) * <span class="name">shipRadius</span>,
                <span class="name">y</span> = <span class="name">shipY</span> + <span class="call">math.sin</span>(<span class="name">shipAngle</span>) * <span class="name">shipRadius</span>,
                <span class="highlight"><span class="name">angle</span> = <span class="name">shipAngle</span>,</span>
            }
        )
    end
end
</pre></div>
<h3>Bullet time left</h3>
<p>Bullets have a timer which starts at 4 seconds and is decreased every frame. When the timer reaches 0, the bullet is removed from the bullets table.</p>
<p>Because bullets are removed from the table while it is being looped through, the loop is changed so that it loops through the table in reverse order.</p>
<div class="pre"><pre class="code">
function <span class="name">love.update</span>(<span class="name">dt</span>)
    <span class="comment">-- etc.</span>

    <span class="highlight">for <span class="name">bulletIndex</span> = #<span class="name">bullets</span>, <span class="literal">1</span>, -<span class="literal">1</span> do</span>
    <span class="highlight">    local <span class="name">bullet</span> = <span class="name">bullets</span>[<span class="name">bulletIndex</span>]</span>

    <span class="highlight">    <span class="name">bullet.timeLeft</span> = <span class="name">bullet.timeLeft</span> - <span class="name">dt</span></span>
    <span class="highlight">    if <span class="name">bullet.timeLeft</span> <= <span class="literal">0</span> then</span>
    <span class="highlight">        <span class="call">table.remove</span>(<span class="name">bullets</span>, <span class="name">bulletIndex</span>)</span>
    <span class="highlight">    else</span>
            local <span class="name">bulletSpeed</span> = <span class="literal">500</span>

            <span class="name">bullet.x</span> = (<span class="name">bullet.x</span> + <span class="call">math.cos</span>(<span class="name">bullet.angle</span>) * <span class="name">bulletSpeed</span> * <span class="name">dt</span>) % <span class="name">arenaWidth</span>
            <span class="name">bullet.y</span> = (<span class="name">bullet.y</span> + <span class="call">math.sin</span>(<span class="name">bullet.angle</span>) * <span class="name">bulletSpeed</span> * <span class="name">dt</span>) % <span class="name">arenaHeight</span>
    <span class="highlight">    end</span>
    end
end

function <span class="name">love.keypressed</span>(<span class="name">key</span>)
    if <span class="name">key</span> == <span class="literal">'s'</span> then
        <span class="call">table.insert</span>(
            <span class="name">bullets</span>, {
                <span class="name">x</span> = <span class="name">shipX</span> + <span class="call">math.cos</span>(<span class="name">shipAngle</span>) * <span class="name">shipRadius</span>,
                <span class="name">y</span> = <span class="name">shipY</span> + <span class="call">math.sin</span>(<span class="name">shipAngle</span>) * <span class="name">shipRadius</span>,
                <span class="name">angle</span> = <span class="name">shipAngle</span>,
                <span class="highlight"><span class="name">timeLeft</span> = <span class="literal">4</span>,</span>
            }
        )
    end
end
</pre></div>
<h3>Holding down shoot key</h3>
<p>Instead of creating a bullet each time the <b>s</b> key is pressed, bullets are created if the <b>s</b> key is down and a timer is ready.</p>
<p>The code from <span class="inlinecode">
<span class="name">love.keypressed</span></span> is moved to <span class="inlinecode">
<span class="name">love.update</span></span>.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="comment">-- etc.</span>

    <span class="name">bulletTimer</span> = <span class="literal">0</span>
end

function <span class="name">love.update</span>(<span class="name">dt</span>)
    <span class="comment">-- etc.</span>

    <span class="highlight"><span class="name">bulletTimer</span> = <span class="name">bulletTimer</span> + <span class="name">dt</span></span>

    <span class="highlight">if <span class="call">love.keyboard.isDown</span>(<span class="literal">'s'</span>) then</span>
    <span class="highlight">    if <span class="name">bulletTimer</span> >= <span class="literal">0.5</span> then</span>
    <span class="highlight">        <span class="name">bulletTimer</span> = <span class="literal">0</span></span>

            <span class="call">table.insert</span>(<span class="name">bullets</span>, {
                <span class="name">x</span> = <span class="name">shipX</span> + <span class="call">math.cos</span>(<span class="name">shipAngle</span>) * <span class="name">shipRadius</span>,
                <span class="name">y</span> = <span class="name">shipY</span> + <span class="call">math.sin</span>(<span class="name">shipAngle</span>) * <span class="name">shipRadius</span>,
                <span class="name">angle</span> = <span class="name">shipAngle</span>,
                <span class="name">timeLeft</span> = <span class="literal">4</span>,
            })
    <span class="highlight">    end</span>
    <span class="highlight">end</span>
end

<span class="comment">-- Removed: love.keypressed</span>
</pre></div>
<h3>Drawing asteroids</h3>
<p>Asteroids have an X and Y position and are drawn with yellow circles.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="comment">-- etc.</span>

    <span class="name">asteroids</span> = {
        {
            <span class="name">x</span> = <span class="literal">100</span>,
            <span class="name">y</span> = <span class="literal">100</span>,
        },
        {
            <span class="name">x</span> = <span class="name">arenaWidth</span> - <span class="literal">100</span>,
            <span class="name">y</span> = <span class="literal">100</span>,
        },
        {
            <span class="name">x</span> = <span class="name">arenaWidth</span> / <span class="literal">2</span>,
            <span class="name">y</span> = <span class="name">arenaHeight</span> - <span class="literal">100</span>,
        }
    }
end

function <span class="name">love.draw</span>()
    for <span class="name">y</span> = -<span class="literal">1</span>, <span class="literal">1</span> do
        for <span class="name">x</span> = -<span class="literal">1</span>, <span class="literal">1</span> do
            <span class="comment">-- etc.</span>

            for <span class="name">asteroidIndex</span>, <span class="name">asteroid</span> in <span class="call">ipairs</span>(<span class="name">asteroids</span>) do
                <span class="call">love.graphics.setColor</span>(<span class="literal">1</span>, <span class="literal">1</span>, <span class="literal">0</span>)
                <span class="call">love.graphics.circle</span>(<span class="literal">'fill'</span>, <span class="name">asteroid.x</span>, <span class="name">asteroid.y</span>, <span class="literal">80</span>)
            end
        end
    end
end
</pre></div>
<img src="16.png">
<h3>Moving asteroids</h3>
<p>Each asteroid is given a random angle which it moves at.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="comment">-- etc.</span>

    for <span class="name">asteroidIndex</span>, <span class="name">asteroid</span> in <span class="call">ipairs</span>(<span class="name">asteroids</span>) do
        <span class="name">asteroid.angle</span> = <span class="call">love.math.random</span>() * (<span class="literal">2</span> * <span class="name">math.pi</span>)
    end
end

function <span class="name">love.update</span>(<span class="name">dt</span>)
    <span class="comment">-- etc.</span>

    for <span class="name">asteroidIndex</span>, <span class="name">asteroid</span> in <span class="call">ipairs</span>(<span class="name">asteroids</span>) do
        local <span class="name">asteroidSpeed</span> = <span class="literal">20</span>
        <span class="name">asteroid.x</span> = (<span class="name">asteroid.x</span> + <span class="call">math.cos</span>(<span class="name">asteroid.angle</span>) * <span class="name">asteroidSpeed</span> * <span class="name">dt</span>) % <span class="name">arenaWidth</span>
        <span class="name">asteroid.y</span> = (<span class="name">asteroid.y</span> + <span class="call">math.sin</span>(<span class="name">asteroid.angle</span>) * <span class="name">asteroidSpeed</span> * <span class="name">dt</span>) % <span class="name">arenaHeight</span>
    end
end
</pre></div>
<h3>Asteroids colliding with ship</h3>
<p>The asteroid table is looped through, and if any asteroids collide with the ship the game is reset.</p>
<p>The asteroid radius is reused, so it is made into a variable.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="comment">-- etc.</span>

    <span class="name">asteroidRadius</span> = <span class="literal">80</span>
end

function <span class="name">love.update</span>(<span class="name">dt</span>)
    <span class="comment">-- etc.</span>

    <span class="highlight">local function <span class="name">areCirclesIntersecting</span>(<span class="name">aX</span>, <span class="name">aY</span>, <span class="name">aRadius</span>, <span class="name">bX</span>, <span class="name">bY</span>, <span class="name">bRadius</span>)</span>
    <span class="highlight">    return (<span class="name">aX</span> - <span class="name">bX</span>)^<span class="literal">2</span> + (<span class="name">aY</span> - <span class="name">bY</span>)^<span class="literal">2</span> <= (<span class="name">aRadius</span> + <span class="name">bRadius</span>)^<span class="literal">2</span></span>
    <span class="highlight">end</span>

    for <span class="name">asteroidIndex</span>, <span class="name">asteroid</span> in <span class="call">ipairs</span>(<span class="name">asteroids</span>) do
        local <span class="name">asteroidSpeed</span> = <span class="literal">20</span>
        <span class="name">asteroid.x</span> = (<span class="name">asteroid.x</span> + <span class="call">math.cos</span>(<span class="name">asteroid.angle</span>) * <span class="name">asteroidSpeed</span> * <span class="name">dt</span>) % <span class="name">arenaWidth</span>
        <span class="name">asteroid.y</span> = (<span class="name">asteroid.y</span> + <span class="call">math.sin</span>(<span class="name">asteroid.angle</span>) * <span class="name">asteroidSpeed</span> * <span class="name">dt</span>) % <span class="name">arenaHeight</span>

        <span class="highlight">if <span class="call">areCirclesIntersecting</span>(<span class="name">shipX</span>, <span class="name">shipY</span>, <span class="name">shipRadius</span>, <span class="name">asteroid.x</span>, <span class="name">asteroid.y</span>, <span class="name">asteroidRadius</span>) then</span>
        <span class="highlight">    <span class="call">love.load</span>()</span>
        <span class="highlight">    break</span>
        <span class="highlight">end</span>
    end
end


function <span class="name">love.draw</span>()
    <span class="comment">-- etc.</span>

    for <span class="name">asteroidIndex</span>, <span class="name">asteroid</span> in <span class="call">ipairs</span>(<span class="name">asteroids</span>) do
        <span class="call">love.graphics.setColor</span>(<span class="literal">1</span>, <span class="literal">1</span>, <span class="literal">0</span>)
        <span class="call">love.graphics.circle</span>(<span class="literal">'fill'</span>, <span class="name">asteroid.x</span>, <span class="name">asteroid.y</span>, <span class="highlight"><span class="name">asteroidRadius</span></span>)
    end
end
</pre></div>
<h3>Bullets colliding with asteroids</h3>
<p>For each bullet, each asteroid is looped through, and if the bullet and asteroid collide, both are removed from their tables.</p>
<p>The <span class="inlinecode">
<span class="name">areCirclesIntersecting</span></span> function is moved above the bullet loop code.</p>
<p>The bullet radius is reused, so it is made into a variable.</p>
<p>Because bullets are removed from the table while it is being looped through, the table is looped through in reverse order.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="comment">-- etc.</span>

    <span class="name">bulletRadius</span> = <span class="literal">5</span>
end

function <span class="name">love.update</span>(<span class="name">dt</span>)
    <span class="comment">-- etc.</span>

    local function <span class="name">areCirclesIntersecting</span>(<span class="name">aX</span>, <span class="name">aY</span>, <span class="name">aRadius</span>, <span class="name">bX</span>, <span class="name">bY</span>, <span class="name">bRadius</span>)
        return (<span class="name">aX</span> - <span class="name">bX</span>)^<span class="literal">2</span> + (<span class="name">aY</span> - <span class="name">bY</span>)^<span class="literal">2</span> <= (<span class="name">aRadius</span> + <span class="name">bRadius</span>)^<span class="literal">2</span>
    end

    for <span class="name">bulletIndex</span> = #<span class="name">bullets</span>, <span class="literal">1</span>, -<span class="literal">1</span> do
        local <span class="name">bullet</span> = <span class="name">bullets</span>[<span class="name">bulletIndex</span>]

        <span class="name">bullet.timeLeft</span> = <span class="name">bullet.timeLeft</span> - <span class="name">dt</span>
        if <span class="name">bullet.timeLeft</span> <= <span class="literal">0</span> then
            <span class="call">table.remove</span>(<span class="name">bullets</span>, <span class="name">bulletIndex</span>)
        else
            local <span class="name">bulletSpeed</span> = <span class="literal">500</span>
            <span class="name">bullet.x</span> = (<span class="name">bullet.x</span> + <span class="call">math.cos</span>(<span class="name">bullet.angle</span>) * <span class="name">bulletSpeed</span> * <span class="name">dt</span>) % <span class="name">arenaWidth</span>
            <span class="name">bullet.y</span> = (<span class="name">bullet.y</span> + <span class="call">math.sin</span>(<span class="name">bullet.angle</span>) * <span class="name">bulletSpeed</span> * <span class="name">dt</span>) % <span class="name">arenaHeight</span>
        end

        <span class="highlight">for <span class="name">asteroidIndex</span> = #<span class="name">asteroids</span>, <span class="literal">1</span>, -<span class="literal">1</span> do</span>
        <span class="highlight">    local <span class="name">asteroid</span> = <span class="name">asteroids</span>[<span class="name">asteroidIndex</span>]</span>

        <span class="highlight">    if <span class="call">areCirclesIntersecting</span>(<span class="name">bullet.x</span>, <span class="name">bullet.y</span>, <span class="name">bulletRadius</span>, <span class="name">asteroid.x</span>, <span class="name">asteroid.y</span>, <span class="name">asteroidRadius</span>) then</span>
        <span class="highlight">        <span class="call">table.remove</span>(<span class="name">bullets</span>, <span class="name">bulletIndex</span>)</span>
        <span class="highlight">        <span class="call">table.remove</span>(<span class="name">asteroids</span>, <span class="name">asteroidIndex</span>)</span>
        <span class="highlight">        break</span>
        <span class="highlight">    end</span>
        <span class="highlight">end</span>
    end

    <span class="comment">-- etc.</span>
end

function <span class="name">love.draw</span>()
    <span class="comment">-- etc.</span>

    for <span class="name">bulletIndex</span>, <span class="name">bullet</span> in <span class="call">ipairs</span>(<span class="name">bullets</span>) do
        <span class="call">love.graphics.setColor</span>(<span class="literal">0</span>, <span class="literal">1</span>, <span class="literal">0</span>)
        <span class="call">love.graphics.circle</span>(<span class="literal">'fill'</span>, <span class="name">bullet.x</span>, <span class="name">bullet.y</span>, <span class="highlight"><span class="name">bulletRadius</span></span>)
    end

    <span class="comment">-- etc.</span>
end
</pre></div>
<h3>Breaking asteroids</h3>
<p>When a bullet and an asteroid collide two new asteroids are created.</p>
<p>The first asteroid is given a random angle, and the second asteroid is given the opposite angle by subtracting pi and using the modulo operator to keep the angle greater than or equal to 0 and less than 2 pi.</p>
<div class="pre"><pre class="code">
function <span class="name">love.update</span>(<span class="name">dt</span>)
    <span class="comment">-- etc.</span>

    for <span class="name">bulletIndex</span> = #<span class="name">bullets</span>, <span class="literal">1</span>, -<span class="literal">1</span> do
        <span class="comment">-- etc.</span>

        for <span class="name">asteroidIndex</span> = #<span class="name">asteroids</span>, <span class="literal">1</span>, -<span class="literal">1</span> do
            local <span class="name">asteroid</span> = <span class="name">asteroids</span>[<span class="name">asteroidIndex</span>]

            if <span class="call">areCirclesIntersecting</span>(<span class="name">bullet.x</span>, <span class="name">bullet.y</span>, <span class="name">bulletRadius</span>, <span class="name">asteroid.x</span>, <span class="name">asteroid.y</span>, <span class="name">asteroidRadius</span>) then
                <span class="call">table.remove</span>(<span class="name">bullets</span>, <span class="name">bulletIndex</span>)

                <span class="highlight">local <span class="name">angle1</span> = <span class="call">love.math.random</span>() * (<span class="literal">2</span> * <span class="name">math.pi</span>)</span>
                <span class="highlight">local <span class="name">angle2</span> = (<span class="name">angle1</span> - <span class="name">math.pi</span>) % (<span class="literal">2</span> * <span class="name">math.pi</span>)</span>

                <span class="highlight"><span class="call">table.insert</span>(<span class="name">asteroids</span>, {</span>
                <span class="highlight">    <span class="name">x</span> = <span class="name">asteroid.x</span>,</span>
                <span class="highlight">    <span class="name">y</span> = <span class="name">asteroid.y</span>,</span>
                <span class="highlight">    <span class="name">angle</span> = <span class="name">angle1</span>,</span>
                <span class="highlight">})</span>
                <span class="highlight"><span class="call">table.insert</span>(<span class="name">asteroids</span>, {</span>
                <span class="highlight">    <span class="name">x</span> = <span class="name">asteroid.x</span>,</span>
                <span class="highlight">    <span class="name">y</span> = <span class="name">asteroid.y</span>,</span>
                <span class="highlight">    <span class="name">angle</span> = <span class="name">angle2</span>,</span>
                <span class="highlight">})</span>

                <span class="call">table.remove</span>(<span class="name">asteroids</span>, <span class="name">asteroidIndex</span>)
                break
            end
        end
    end

    <span class="comment">-- etc.</span>
end
</pre></div>
<h3>Asteroid stages</h3>
<p>The different stages an asteroid can be in are stored in a table, indexed by a number given to each asteroid. This number starts at the last stage.</p>
<p>The two new asteroids created when an asteroid is hit by a bullet are now only created if the asteroid hit is above the first stage. The new asteroids are created with a stage one less than the asteroid that was hit.</p>
<p>References to an asteroid's speed and radius are changed to refer to the speed and radius at the stage that the asteroid is currently at.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="comment">-- etc.</span>

    <span class="name">asteroidStages</span> = {
        {
            <span class="name">speed</span> = <span class="literal">120</span>,
            <span class="name">radius</span> = <span class="literal">15</span>
        },
        {
            <span class="name">speed</span> = <span class="literal">70</span>,
            <span class="name">radius</span> = <span class="literal">30</span>
        },
        {
            <span class="name">speed</span> = <span class="literal">50</span>,
            <span class="name">radius</span> = <span class="literal">50</span>
        },
        {
            <span class="name">speed</span> = <span class="literal">20</span>,
            <span class="name">radius</span> = <span class="literal">80</span>
        }
    }

    for <span class="name">asteroidIndex</span>, <span class="name">asteroid</span> in <span class="call">ipairs</span>(<span class="name">asteroids</span>) do
        <span class="name">asteroid.angle</span> = <span class="call">love.math.random</span>() * (<span class="literal">2</span> * <span class="name">math.pi</span>)
        <span class="highlight"><span class="name">asteroid.stage</span> = #<span class="name">asteroidStages</span></span>
    end

    <span class="comment">-- Removed: asteroidRadius = 80</span>
end

function <span class="name">love.update</span>(<span class="name">dt</span>)
    <span class="comment">-- etc.</span>

    for <span class="name">bulletIndex</span> = #<span class="name">bullets</span>, <span class="literal">1</span>, -<span class="literal">1</span> do
        <span class="comment">-- etc.</span>

        for <span class="name">asteroidIndex</span> = #<span class="name">asteroids</span>, <span class="literal">1</span>, -<span class="literal">1</span> do
            local <span class="name">asteroid</span> = <span class="name">asteroids</span>[<span class="name">asteroidIndex</span>]

            if <span class="call">areCirclesIntersecting</span>(<span class="name">bullet.x</span>, <span class="name">bullet.y</span>, <span class="name">bulletRadius</span>, <span class="name">asteroid.x</span>, <span class="name">asteroid.y</span>, <span class="highlight"><span class="name">asteroidStages</span>[<span class="name">asteroid.stage</span>].<span class="name">radius</span></span>) then
                <span class="call">table.remove</span>(<span class="name">bullets</span>, <span class="name">bulletIndex</span>)

                <span class="highlight">if <span class="name">asteroid.stage</span> > <span class="literal">1</span> then</span>
                    local <span class="name">angle1</span> = <span class="call">love.math.random</span>() * (<span class="literal">2</span> * <span class="name">math.pi</span>)
                    local <span class="name">angle2</span> = (<span class="name">angle1</span> - <span class="name">math.pi</span>) % (<span class="literal">2</span> * <span class="name">math.pi</span>)

                    <span class="call">table.insert</span>(<span class="name">asteroids</span>, {
                        <span class="name">x</span> = <span class="name">asteroid.x</span>,
                        <span class="name">y</span> = <span class="name">asteroid.y</span>,
                        <span class="name">angle</span> = <span class="name">angle1</span>,
                        <span class="highlight"><span class="name">stage</span> = <span class="name">asteroid.stage</span> - <span class="literal">1</span>,</span>
                    })
                    <span class="call">table.insert</span>(<span class="name">asteroids</span>, {
                        <span class="name">x</span> = <span class="name">asteroid.x</span>,
                        <span class="name">y</span> = <span class="name">asteroid.y</span>,
                        <span class="name">angle</span> = <span class="name">angle2</span>,
                        <span class="highlight"><span class="name">stage</span> = <span class="name">asteroid.stage</span> - <span class="literal">1</span>,</span>
                    })
                <span class="highlight">end</span>

                <span class="call">table.remove</span>(<span class="name">asteroids</span>, <span class="name">asteroidIndex</span>)
                break
            end
        end
    end

    for <span class="name">asteroidIndex</span>, <span class="name">asteroid</span> in <span class="call">ipairs</span>(<span class="name">asteroids</span>) do
        <span class="comment">-- Removed: local asteroidSpeed = 20</span>
        <span class="name">asteroid.x</span> = (<span class="name">asteroid.x</span> + <span class="call">math.cos</span>(<span class="name">asteroid.angle</span>) * <span class="highlight"><span class="name">asteroidStages</span>[<span class="name">asteroid.stage</span>].<span class="name">speed</span></span> * <span class="name">dt</span>) % <span class="name">arenaWidth</span>
        <span class="name">asteroid.y</span> = (<span class="name">asteroid.y</span> + <span class="call">math.sin</span>(<span class="name">asteroid.angle</span>) * <span class="highlight"><span class="name">asteroidStages</span>[<span class="name">asteroid.stage</span>].<span class="name">speed</span></span> * <span class="name">dt</span>) % <span class="name">arenaHeight</span>

        if <span class="call">areCirclesIntersecting</span>(<span class="name">shipX</span>, <span class="name">shipY</span>, <span class="name">shipRadius</span>, <span class="name">asteroid.x</span>, <span class="name">asteroid.y</span>, <span class="highlight"><span class="name">asteroidStages</span>[<span class="name">asteroid.stage</span>].<span class="name">radius</span></span>) then
            <span class="call">love.load</span>()
            break
        end
    end
end

function <span class="name">love.draw</span>()
    for <span class="name">y</span> = -<span class="literal">1</span>, <span class="literal">1</span> do
        for <span class="name">x</span> = -<span class="literal">1</span>, <span class="literal">1</span> do
            <span class="comment">-- etc.</span>

            for <span class="name">asteroidIndex</span>, <span class="name">asteroid</span> in <span class="call">ipairs</span>(<span class="name">asteroids</span>) do
                <span class="call">love.graphics.setColor</span>(<span class="literal">1</span>, <span class="literal">1</span>, <span class="literal">0</span>)
                <span class="call">love.graphics.circle</span>(<span class="literal">'fill'</span>, <span class="name">asteroid.x</span>, <span class="name">asteroid.y</span>, <span class="highlight"><span class="name">asteroidStages</span>[<span class="name">asteroid.stage</span>].<span class="name">radius</span></span>)
            end
        end
    end
end
</pre></div>
<h3>Game over</h3>
<p>If there are no more asteroids in the asteroids table the game is reset.</p>
<div class="pre"><pre class="code">
function <span class="name">love.update</span>(<span class="name">dt</span>)
    <span class="comment">-- etc.</span>

    if #<span class="name">asteroids</span> == <span class="literal">0</span> then
        <span class="call">love.load</span>()
    end
end
</pre></div>
</body></html>
